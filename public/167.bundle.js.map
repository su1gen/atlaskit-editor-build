{"version":3,"sources":["webpack:///./node_modules/@atlaskit/media-viewer/dist/esm/viewers/base-viewer.js","webpack:///./node_modules/@atlaskit/media-ui/dist/esm/imageMetaData/types.js","webpack:///./node_modules/@atlaskit/media-ui/dist/esm/imageMetaData/parseJPEG.js","webpack:///./node_modules/@atlaskit/media-ui/dist/esm/imageMetaData/parsePNG.js","webpack:///./node_modules/@atlaskit/media-ui/dist/esm/imageMetaData/parsePNGXMP.js","webpack:///./node_modules/@atlaskit/media-ui/dist/esm/imageMetaData/metatags.js","webpack:///./node_modules/@atlaskit/media-ui/dist/esm/imageMetaData/index.js","webpack:///./node_modules/@atlaskit/media-viewer/dist/esm/viewers/image/index.js"],"names":["_createSuper","Derived","hasNativeReflectConstruct","Reflect","construct","sham","Proxy","Boolean","prototype","valueOf","call","e","_isNativeReflectConstruct","result","Super","NewTarget","this","constructor","arguments","apply","BaseViewer","_React$Component","_super","_this","_len","length","args","Array","_key","concat","getInitialState","item","props","emit","fileId","id","viewingLevel","key","value","init","release","nextProps","needsReset","setState","initialState","prevProps","_this2","state","content","match","pending","createElement","successful","renderSuccessful","failed","error","fileState","supressAnalytics","try_downloading_file","renderDownloadButton","_this$props","mediaClient","collectionName","propsA","propsB","Component","ImageType","SupportedImageMetaTag","loadImage","ExifOrientation","XResolution","YResolution","readJPEGExifMetaData","file","Promise","_ref","mark","_callee","resolve","reject","module","wrap","_context","prev","next","sent","default","parseMetaData","data","tags","exif","getAll","Object","keys","forEach","numerator","stop","_x","_x2","pngChunksExtract","readPNGXMPMetaData","_readPNGXMPMetaData","buffer","chunks","parsePNGChunks","abrupt","_parsePNGChunks","_callee2","iTXt","pHYs","i","chunk","dv","PixelPerUnitX","PixelPerUnitY","_context2","name","String","fromCharCode","from","DataView","getUint8","getUint32","parseXMPMetaData","xmpMetaData","metadata","tag","ownKeys","object","enumerableOnly","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","_objectSpread","target","source","getOwnPropertyDescriptors","defineProperties","defineProperty","readImageMetaTags","_readImageMetaTags","type","_yield$readPNGXMPMeta","PNG","JPEG","t0","Orientation","getImageInfo","_getImageInfo","fileInfo","width","height","scaleFactor","readImageMetaData","getScaleFactor","scaleFactorFromFilename","trim","parseFloat","getScaleFactorFromFile","Math","round","getMetaTagNumericValue","tagValue","numericValue","parseInt","isNaN","getOrientation","_getOrientation","defaultValue","num","_x3","_readImageMetaData","_callee3","src","orientation","isImageRotated","img","_readImageNaturalOrie","_width","_height","_context3","PixelXDimension","naturalWidth","naturalHeight","ImageViewer","_BaseViewer","_init","onLoad","onMediaDisplayed","onError","get","objectUrl","originalBinaryImageUrl","isLocalFileReference","preview","_yield$preview","origin","controller","response","imgError","status","Blob","URL","createObjectURL","details","AbortController","undefined","getImage","collection","mode","cancelImageFetch","abort","t1","mediaType","mimeType","getFileBinaryURL","t2","whenSuccessful","revokeObjectUrl","revokeObjectURL","_this$props2","onClose","contextId","onImgError","originalBinaryImageSrc"],"mappings":"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","file":"167.bundle.js","sourcesContent":["import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from 'react';\nimport { FormattedMessage } from 'react-intl-next';\nimport { messages } from '@atlaskit/media-ui';\nimport deepEqual from 'deep-equal';\nimport { globalMediaEventEmitter } from '@atlaskit/media-client';\nimport ErrorMessage from '../errorMessage';\nimport { Spinner } from '../loading';\nimport { ErrorViewDownloadButton } from '../download';\nexport var BaseViewer = /*#__PURE__*/function (_React$Component) {\n  _inherits(BaseViewer, _React$Component);\n\n  var _super = _createSuper(BaseViewer);\n\n  function BaseViewer() {\n    var _this;\n\n    _classCallCheck(this, BaseViewer);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", _this.getInitialState());\n\n    _defineProperty(_assertThisInitialized(_this), \"onMediaDisplayed\", function () {\n      var item = _this.props.item;\n      globalMediaEventEmitter.emit('media-viewed', {\n        fileId: item.id,\n        viewingLevel: 'full'\n      });\n    });\n\n    return _this;\n  }\n\n  _createClass(BaseViewer, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.init();\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.release();\n    } // NOTE: We've moved parts of the logic to reset a component into this method\n    // to optimise the performance. Resetting the state before the `componentDidUpdate`\n    // lifecycle event allows us avoid one additional render cycle.\n    // However, this lifecycle method might eventually be deprecated, so be careful\n    // when working with it.\n\n  }, {\n    key: \"UNSAFE_componentWillReceiveProps\",\n    value: function UNSAFE_componentWillReceiveProps(nextProps) {\n      if (this.needsReset(nextProps, this.props)) {\n        this.release();\n        this.setState(this.initialState);\n      }\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      if (this.needsReset(prevProps, this.props)) {\n        this.init();\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      return this.state.content.match({\n        pending: function pending() {\n          return /*#__PURE__*/React.createElement(Spinner, null);\n        },\n        successful: function successful(content) {\n          return _this2.renderSuccessful(content);\n        },\n        failed: function failed(error) {\n          var item = _this2.props.item;\n          return /*#__PURE__*/React.createElement(ErrorMessage, {\n            fileId: item.id,\n            fileState: item,\n            error: error,\n            supressAnalytics: true // item-viewer.tsx will send\n\n          }, /*#__PURE__*/React.createElement(\"p\", null, /*#__PURE__*/React.createElement(FormattedMessage, messages.try_downloading_file)), _this2.renderDownloadButton(error));\n        }\n      });\n    } // Accessing abstract getters in a constructor is not allowed\n\n  }, {\n    key: \"getInitialState\",\n    value: function getInitialState() {\n      return this.initialState;\n    }\n  }, {\n    key: \"renderDownloadButton\",\n    value: function renderDownloadButton(error) {\n      var _this$props = this.props,\n          item = _this$props.item,\n          mediaClient = _this$props.mediaClient,\n          collectionName = _this$props.collectionName;\n      return /*#__PURE__*/React.createElement(ErrorViewDownloadButton, {\n        fileState: item,\n        mediaClient: mediaClient,\n        error: error,\n        collectionName: collectionName\n      });\n    }\n  }, {\n    key: \"needsReset\",\n    value: function needsReset(propsA, propsB) {\n      return !deepEqual(propsA.item, propsB.item) || propsA.mediaClient !== propsB.mediaClient || propsA.collectionName !== propsB.collectionName;\n    }\n  }]);\n\n  return BaseViewer;\n}(React.Component);","export var ImageType;\n\n(function (ImageType) {\n  ImageType[\"JPEG\"] = \"image/jpeg\";\n  ImageType[\"PNG\"] = \"image/png\";\n})(ImageType || (ImageType = {}));\n\nexport var SupportedImageMetaTag;\n\n(function (SupportedImageMetaTag) {\n  SupportedImageMetaTag[\"XResolution\"] = \"XResolution\";\n  SupportedImageMetaTag[\"YResolution\"] = \"YResolution\";\n  SupportedImageMetaTag[\"Orientation\"] = \"Orientation\";\n})(SupportedImageMetaTag || (SupportedImageMetaTag = {}));\n\n// http://sylvana.net/jpegcrop/exif_orientation.html\nexport var ExifOrientation = {\n  'top-left': 1,\n  // none\n  'top-right': 2,\n  // flip horizontal\n  'bottom-right': 3,\n  // rotate 180\n  'bottom-left': 4,\n  // flip vertical\n  'left-top': 5,\n  // transpose\n  'right-top': 6,\n  // rotate 90\n  'right-bottom': 7,\n  // transverse\n  'left-bottom': 8 // rotate 270\n\n};","import _typeof from \"@babel/runtime/helpers/typeof\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport { SupportedImageMetaTag } from './types';\nvar XResolution = SupportedImageMetaTag.XResolution,\n    YResolution = SupportedImageMetaTag.YResolution;\nvar loadImage;\nexport function readJPEGExifMetaData(file) {\n  return new Promise( /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(resolve, reject) {\n      var module;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (loadImage) {\n                _context.next = 5;\n                break;\n              }\n\n              _context.next = 3;\n              return import('blueimp-load-image');\n\n            case 3:\n              module = _context.sent;\n              loadImage = module.default || module;\n\n            case 5:\n              loadImage.parseMetaData(file, function (data) {\n                try {\n                  var tags = data && data.exif ? data.exif.getAll() : {};\n                  Object.keys(tags).forEach(function (key) {\n                    var value = tags[key];\n\n                    if (_typeof(value) === 'object' && (key === XResolution || key === YResolution) && 'numerator' in value) {\n                      // some test images had this structure, so just take the numerator value to simplify returned value\n                      tags[key] = value.numerator;\n                    }\n\n                    if (typeof tags[key] === 'number') {\n                      // in case numbers types were auto-converted, keep everything the same between jpeg & png we keep as strings\n                      tags[key] = \"\".concat(tags[key]);\n                    }\n                  });\n                  resolve(tags);\n                } catch (e) {\n                  reject(e);\n                }\n              });\n\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function (_x, _x2) {\n      return _ref.apply(this, arguments);\n    };\n  }());\n}","import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport { fileToArrayBuffer } from '../util';\nvar pngChunksExtract;\nexport function readPNGXMPMetaData(_x) {\n  return _readPNGXMPMetaData.apply(this, arguments);\n}\n\nfunction _readPNGXMPMetaData() {\n  _readPNGXMPMetaData = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(file) {\n    var module, buffer, chunks;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (pngChunksExtract) {\n              _context.next = 5;\n              break;\n            }\n\n            _context.next = 3;\n            return import('png-chunks-extract');\n\n          case 3:\n            module = _context.sent;\n            pngChunksExtract = module.default || module;\n\n          case 5:\n            _context.next = 7;\n            return fileToArrayBuffer(file);\n\n          case 7:\n            buffer = _context.sent;\n            chunks = pngChunksExtract(buffer);\n            _context.next = 11;\n            return parsePNGChunks(chunks);\n\n          case 11:\n            return _context.abrupt(\"return\", _context.sent);\n\n          case 12:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n  return _readPNGXMPMetaData.apply(this, arguments);\n}\n\nexport function parsePNGChunks(_x2) {\n  return _parsePNGChunks.apply(this, arguments);\n}\n\nfunction _parsePNGChunks() {\n  _parsePNGChunks = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(chunks) {\n    var iTXt, pHYs, i, chunk, dv, unitSpecifier, PixelPerUnitX, PixelPerUnitY;\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            iTXt = '';\n            pHYs = {};\n            /**\n             * http://www.libpng.org/pub/png/spec/1.2/PNG-Chunks.html#C.Summary-of-standard-chunks\n             * Order of every chunk is not guaranteed.\n             * And both iTXt and pHYs are Ancillary chunks.\n             */\n\n            i = 0;\n\n          case 3:\n            if (!(i < chunks.length)) {\n              _context2.next = 12;\n              break;\n            }\n\n            chunk = chunks[i]; // Must be last\n\n            if (!(chunk.name === 'IEND')) {\n              _context2.next = 7;\n              break;\n            }\n\n            return _context2.abrupt(\"break\", 12);\n\n          case 7:\n            /**\n             * http://www.libpng.org/pub/png/spec/1.2/PNG-Chunks.html#C.Anc-text\n             * iTXt contains the useful XMP/XML string data of meta tags\n             */\n            if (chunk.name === 'iTXt') {\n              iTXt = String.fromCharCode.apply(null, Array.from(chunk.data));\n            }\n            /**\n             * http://www.libpng.org/pub/png/spec/1.2/PNG-Chunks.html#C.pHYs\n             * Pixels per unit, X axis: 4 bytes (unsigned integer)\n             * Pixels per unit, Y axis: 4 bytes (unsigned integer)\n             * Unit specifier:          1 byte  (0: unit is unknown 1: unit is the meter)\n             */\n\n\n            if (chunk.name === 'pHYs') {\n              dv = new DataView(chunk.data.buffer);\n              unitSpecifier = dv.getUint8(8); // meter\n\n              if (unitSpecifier === 1) {\n                PixelPerUnitX = dv.getUint32(0);\n                PixelPerUnitY = dv.getUint32(4);\n                pHYs = {\n                  PixelPerUnitX: PixelPerUnitX,\n                  PixelPerUnitY: PixelPerUnitY\n                };\n              }\n            }\n\n          case 9:\n            ++i;\n            _context2.next = 3;\n            break;\n\n          case 12:\n            return _context2.abrupt(\"return\", {\n              iTXt: iTXt,\n              pHYs: pHYs\n            });\n\n          case 13:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n  return _parsePNGChunks.apply(this, arguments);\n}","export function parseXMPMetaData(xmpMetaData) {\n  var metadata = {};\n  var tags = xmpMetaData.match(/<(tiff|exif):.+>/gi);\n\n  if (tags) {\n    tags.forEach(function (tag) {\n      var match = tag.match(/<(tiff|exif):([^>]+)>([^<]+)/i);\n\n      if (match) {\n        var name = match[2];\n        metadata[name] = match[3];\n      }\n    });\n  }\n\n  return metadata;\n}","import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nimport { ImageType } from './types';\nimport { readJPEGExifMetaData } from './parseJPEG';\nimport { readPNGXMPMetaData } from './parsePNG';\nimport { parseXMPMetaData } from './parsePNGXMP';\nexport function readImageMetaTags(_x) {\n  return _readImageMetaTags.apply(this, arguments);\n}\n\nfunction _readImageMetaTags() {\n  _readImageMetaTags = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(file) {\n    var type, _yield$readPNGXMPMeta, iTXt, pHYs, xmpMetaData;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            type = file.type;\n            _context.prev = 1;\n\n            if (!(type === ImageType.PNG)) {\n              _context.next = 12;\n              break;\n            }\n\n            _context.next = 5;\n            return readPNGXMPMetaData(file);\n\n          case 5:\n            _yield$readPNGXMPMeta = _context.sent;\n            iTXt = _yield$readPNGXMPMeta.iTXt;\n            pHYs = _yield$readPNGXMPMeta.pHYs;\n            xmpMetaData = _objectSpread(_objectSpread({}, parseXMPMetaData(iTXt)), pHYs);\n            return _context.abrupt(\"return\", xmpMetaData);\n\n          case 12:\n            if (!(file.type === ImageType.JPEG)) {\n              _context.next = 16;\n              break;\n            }\n\n            _context.next = 15;\n            return readJPEGExifMetaData(file);\n\n          case 15:\n            return _context.abrupt(\"return\", _context.sent);\n\n          case 16:\n            _context.next = 20;\n            break;\n\n          case 18:\n            _context.prev = 18;\n            _context.t0 = _context[\"catch\"](1);\n\n          case 20:\n            return _context.abrupt(\"return\", null);\n\n          case 21:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[1, 18]]);\n  }));\n  return _readImageMetaTags.apply(this, arguments);\n}","import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport { SupportedImageMetaTag, ExifOrientation } from './types';\nimport { readImageMetaTags } from './metatags';\nimport { loadImage, readImageNaturalOrientationFromDOM } from '../util';\nimport { isRotated } from './imageOrientationUtil';\nvar Orientation = SupportedImageMetaTag.Orientation,\n    XResolution = SupportedImageMetaTag.XResolution; // http://bonfx.com/why-is-the-web-72-dpi-and-print-300-dpi/\n\nvar DPI_WEB_BASELINE = 72;\nexport { ExifOrientation } from './types';\nexport function getImageInfo(_x) {\n  return _getImageInfo.apply(this, arguments);\n}\n\nfunction _getImageInfo() {\n  _getImageInfo = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(fileInfo) {\n    var metadata, width, height, tags, scaleFactor;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return readImageMetaData(fileInfo);\n\n          case 2:\n            metadata = _context.sent;\n\n            if (metadata) {\n              _context.next = 5;\n              break;\n            }\n\n            return _context.abrupt(\"return\", null);\n\n          case 5:\n            width = metadata.width, height = metadata.height, tags = metadata.tags;\n            scaleFactor = getScaleFactor(fileInfo.file, tags);\n            return _context.abrupt(\"return\", {\n              scaleFactor: scaleFactor,\n              width: width,\n              height: height\n            });\n\n          case 8:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n  return _getImageInfo.apply(this, arguments);\n}\n\nexport function getScaleFactor(file, tags) {\n  var scaleFactorFromFilename = getScaleFactorFromFile(file);\n\n  if (scaleFactorFromFilename !== null) {\n    return scaleFactorFromFilename;\n  } else if (tags) {\n    /**\n     * Scale Factor is actually a 2D thing, but in practice X & Y are same in 99% cases.\n     * So we are only relying on X axis.\n     */\n    if (typeof tags['PixelPerUnitX'] === 'number') {\n      // 1 inch = 0.0254 meters\n      return Math.round(tags['PixelPerUnitX'] * 0.0254) / DPI_WEB_BASELINE;\n    } else {\n      return getMetaTagNumericValue(tags, XResolution, DPI_WEB_BASELINE) / DPI_WEB_BASELINE;\n    }\n  } else {\n    return 1;\n  }\n}\n\nvar getOrientationFromTags = function getOrientationFromTags(tags) {\n  if (tags && tags[Orientation]) {\n    var tagValue = tags[Orientation];\n\n    if (tagValue) {\n      var numericValue = parseInt(tagValue, 10);\n\n      if (isNaN(numericValue)) {\n        return ExifOrientation[tagValue];\n      }\n\n      return numericValue;\n    }\n  }\n\n  return 1;\n};\n\nexport function getOrientation(_x2) {\n  return _getOrientation.apply(this, arguments);\n}\n\nfunction _getOrientation() {\n  _getOrientation = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(file) {\n    var tags;\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 2;\n            return readImageMetaTags(file);\n\n          case 2:\n            tags = _context2.sent;\n            return _context2.abrupt(\"return\", getOrientationFromTags(tags));\n\n          case 4:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n  return _getOrientation.apply(this, arguments);\n}\n\nexport function getMetaTagNumericValue(tags, key, defaultValue) {\n  try {\n    var num = parseFloat(\"\".concat(tags[key]));\n\n    if (!isNaN(num)) {\n      return num;\n    }\n  } catch (e) {//\n  }\n\n  return defaultValue;\n}\nexport function getScaleFactorFromFile(file) {\n  try {\n    // filenames with scale ratio in name take precedence - eg. filename@2x.png\n    var match = file.name.trim().match(/@([0-9\\.]+)x\\.[a-z]{3}$/);\n\n    if (match) {\n      return parseFloat(match[1]);\n    }\n  } catch (e) {// parse problem, return null\n  }\n\n  return null;\n}\nexport function readImageMetaData(_x3) {\n  return _readImageMetaData.apply(this, arguments);\n}\n\nfunction _readImageMetaData() {\n  _readImageMetaData = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(fileInfo) {\n    var file, src, type, width, height, tags, orientation, isImageRotated, data, img, _readImageNaturalOrie, _width, _height;\n\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            file = fileInfo.file, src = fileInfo.src;\n            type = file.type;\n            width = 0;\n            height = 0;\n            _context3.next = 6;\n            return readImageMetaTags(file);\n\n          case 6:\n            tags = _context3.sent;\n\n            // since we're reading metadata anyway, try to get dimensions from there...\n            if (tags && tags.PixelXDimension) {\n              width = getMetaTagNumericValue(tags, 'PixelXDimension', 0);\n            }\n\n            if (tags && tags.PixelXDimension) {\n              height = getMetaTagNumericValue(tags, 'PixelYDimension', 0);\n            } // otherwise, load the image async (ideally avoid if found above due to being slightly expensive)\n\n\n            orientation = getOrientationFromTags(tags);\n            isImageRotated = isRotated(orientation);\n            data = {\n              type: type,\n              width: width,\n              height: height,\n              naturalWidth: width,\n              naturalHeight: height,\n              tags: tags\n            };\n\n            if (!(isImageRotated || width === 0 && height === 0)) {\n              _context3.next = 27;\n              break;\n            }\n\n            _context3.prev = 13;\n            _context3.next = 16;\n            return loadImage(src);\n\n          case 16:\n            img = _context3.sent;\n            _readImageNaturalOrie = readImageNaturalOrientationFromDOM(img), _width = _readImageNaturalOrie.width, _height = _readImageNaturalOrie.height;\n            data.width = _width;\n            data.height = _height;\n            data.naturalWidth = img.naturalWidth;\n            data.naturalHeight = img.naturalHeight;\n            _context3.next = 27;\n            break;\n\n          case 24:\n            _context3.prev = 24;\n            _context3.t0 = _context3[\"catch\"](13);\n            return _context3.abrupt(\"return\", null);\n\n          case 27:\n            return _context3.abrupt(\"return\", data);\n\n          case 28:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3, null, [[13, 24]]);\n  }));\n  return _readImageMetaData.apply(this, arguments);\n}\n\nexport { getCssFromImageOrientation, isRotated } from './imageOrientationUtil';","import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from 'react';\nimport { isAbortedRequestError, isImageRepresentationReady, isImageMimeTypeSupportedByBrowser, isErrorFileState, addFileAttrsToUrl } from '@atlaskit/media-client';\nimport { getOrientation } from '@atlaskit/media-ui';\nimport { Outcome } from '../../domain';\nimport { MediaViewerError } from '../../errors';\nimport { InteractiveImg } from './interactive-img';\nimport { BaseViewer } from '../base-viewer';\n\nfunction processedFileStateToMediaItem(file) {\n  return {\n    type: 'file',\n    details: {\n      id: file.id\n    }\n  };\n}\n\nexport var ImageViewer = /*#__PURE__*/function (_BaseViewer) {\n  _inherits(ImageViewer, _BaseViewer);\n\n  var _super = _createSuper(ImageViewer);\n\n  function ImageViewer() {\n    var _this;\n\n    _classCallCheck(this, ImageViewer);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"onLoad\", function () {\n      _this.props.onLoad();\n\n      _this.onMediaDisplayed();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onImgError\", function () {\n      _this.props.onError(new MediaViewerError('imageviewer-src-onerror'));\n    });\n\n    return _this;\n  }\n\n  _createClass(ImageViewer, [{\n    key: \"initialState\",\n    get: function get() {\n      return {\n        content: Outcome.pending()\n      };\n    }\n  }, {\n    key: \"init\",\n    value: function () {\n      var _init = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var _this$props, fileState, mediaClient, collectionName, orientation, objectUrl, originalBinaryImageUrl, isLocalFileReference, preview, _yield$preview, value, origin, item, controller, response, imgError;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _this$props = this.props, fileState = _this$props.item, mediaClient = _this$props.mediaClient, collectionName = _this$props.collectionName;\n\n                if (!(fileState.status === 'error')) {\n                  _context.next = 3;\n                  break;\n                }\n\n                return _context.abrupt(\"return\");\n\n              case 3:\n                _context.prev = 3;\n                orientation = 1;\n                isLocalFileReference = false;\n                preview = fileState.preview;\n\n                if (!preview) {\n                  _context.next = 24;\n                  break;\n                }\n\n                _context.next = 10;\n                return preview;\n\n              case 10:\n                _yield$preview = _context.sent;\n                value = _yield$preview.value;\n                origin = _yield$preview.origin;\n\n                if (!(value instanceof Blob)) {\n                  _context.next = 21;\n                  break;\n                }\n\n                _context.next = 16;\n                return getOrientation(value);\n\n              case 16:\n                orientation = _context.sent;\n                objectUrl = URL.createObjectURL(value);\n                isLocalFileReference = origin === 'local';\n                _context.next = 22;\n                break;\n\n              case 21:\n                objectUrl = value;\n\n              case 22:\n                _context.next = 38;\n                break;\n\n              case 24:\n                if (!isImageRepresentationReady(fileState)) {\n                  _context.next = 36;\n                  break;\n                }\n\n                item = processedFileStateToMediaItem(fileState);\n                controller = typeof AbortController !== 'undefined' ? new AbortController() : undefined;\n                response = mediaClient.getImage(item.details.id, {\n                  collection: collectionName,\n                  mode: 'fit'\n                }, controller, true);\n\n                this.cancelImageFetch = function () {\n                  return controller && controller.abort();\n                };\n\n                _context.t0 = URL;\n                _context.next = 32;\n                return response;\n\n              case 32:\n                _context.t1 = _context.sent;\n                objectUrl = _context.t0.createObjectURL.call(_context.t0, _context.t1);\n                _context.next = 38;\n                break;\n\n              case 36:\n                this.setState({\n                  content: Outcome.pending()\n                });\n                return _context.abrupt(\"return\");\n\n              case 38:\n                if (!(!isLocalFileReference && // objectUrl at this point is binary file already\n                !isErrorFileState(fileState) && fileState.status !== 'uploading' && fileState.mediaType === 'image' && isImageMimeTypeSupportedByBrowser(fileState.mimeType))) {\n                  _context.next = 42;\n                  break;\n                }\n\n                _context.next = 41;\n                return mediaClient.file.getFileBinaryURL(fileState.id, collectionName);\n\n              case 41:\n                originalBinaryImageUrl = _context.sent;\n\n              case 42:\n                this.setState({\n                  content: Outcome.successful({\n                    objectUrl: objectUrl,\n                    orientation: orientation,\n                    originalBinaryImageUrl: originalBinaryImageUrl\n                  })\n                });\n                _context.next = 48;\n                break;\n\n              case 45:\n                _context.prev = 45;\n                _context.t2 = _context[\"catch\"](3);\n\n                // TODO : properly handle aborted requests (MS-2843)\n                if (!isAbortedRequestError(_context.t2)) {\n                  imgError = new MediaViewerError('imageviewer-fetch-url', _context.t2);\n                  this.setState({\n                    content: Outcome.failed(imgError)\n                  });\n                  this.props.onError(imgError);\n                }\n\n              case 48:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[3, 45]]);\n      }));\n\n      function init() {\n        return _init.apply(this, arguments);\n      }\n\n      return init;\n    }()\n  }, {\n    key: \"release\",\n    value: function release() {\n      var _this2 = this;\n\n      if (this.cancelImageFetch) {\n        this.cancelImageFetch();\n      }\n\n      this.state.content.whenSuccessful(function (_ref) {\n        var objectUrl = _ref.objectUrl;\n\n        _this2.revokeObjectUrl(objectUrl);\n      });\n    } // This method is spied on by some test cases, so don't rename or remove it.\n\n  }, {\n    key: \"revokeObjectUrl\",\n    value: function revokeObjectUrl(objectUrl) {\n      URL.revokeObjectURL(objectUrl);\n    }\n  }, {\n    key: \"renderSuccessful\",\n    value: function renderSuccessful(content) {\n      var _this$props2 = this.props,\n          item = _this$props2.item,\n          onClose = _this$props2.onClose,\n          contextId = _this$props2.contextId,\n          collectionName = _this$props2.collectionName;\n      var src = contextId ? addFileAttrsToUrl(content.objectUrl, {\n        id: item.id,\n        contextId: contextId,\n        collection: collectionName\n      }) : content.objectUrl;\n      return /*#__PURE__*/React.createElement(InteractiveImg, {\n        onLoad: this.onLoad,\n        onError: this.onImgError,\n        src: src,\n        originalBinaryImageSrc: content.originalBinaryImageUrl,\n        orientation: content.orientation,\n        onClose: onClose\n      });\n    }\n  }]);\n\n  return ImageViewer;\n}(BaseViewer);"],"sourceRoot":""}